# 模型参数估计结果可视化后分析

## 背景介绍

- 在Differential Parameter Learning (dPL)的框架下,我们利用深度学习模型用于预测水文模型中原本需要率定的参数(甚至包含Time-Varing参数)
- Feng等人还定义了evolve Model的说法,意思就是指一个模型同时使用多组参数进行预测并最终通过平均的方式进行求和,最终得到径流模拟结果

## 当前存在的问题

- TCN,S4D,Transformer等模型预测出来的参数之间相关性较低
- 参数估计结果大多偏向于0或者1,边界点过多
- 动态参数估计时变特征不规则,出现明显锯齿变化特性,短期变化程度极为剧烈

## 提问

- 为什么LSTM,GRU等循环结构的预测结果是有规则相关性高的参数变化过程
- 为什么TCN,S4D,Transformer等模型模型参数估计结果更喜欢边界0或者1
- 为什么TCN,S4D,Transformer参数估计的时间变化程度非常剧烈没有LSTM那么平滑
- 为什么TCN,S4D,Transformer参数估计的各组参数之间相关性特别低

## 已经实施的方案

- 猜测TCN,S4D,Transformer输出结果到Linear层放大了参数变化特征,因此使用Conv1d,tanh,weight_norm方法分别进行处理,但是都未解决参数不规则问题
- 在Linear层还额外添加一个高斯平滑层,一定程度上的确降低了时间变化的剧烈程度,精度影响较小,但是为什么需要加入这个才行,LSTM为什么不用加入
- 考虑sigmoid与MSE之间兼容性不是很好, 准备使用Tanh替换sigmoid激活函数[未实施]
- 准备使用Dlinear这种极度简单的模型,查看这种模型是否也存在这种问题

## 不考虑的方向 [针对大模型的]

- 添加正则化约束(目前损失函数已经设计的很好,自行添加会严重影响模型预测精度)

## 预期实现的目标

- 使用TimeMixer查看其他模型是否也是这样的参数特征
- 设置nmul=1,查看当只估计一组参数时,这个参数是否还存在不规则变化


## 结果的内容 3.2

(1) 展示模型参数动态估计结果

- LSTM/GRU等循环结构表现出有周期规律,短期变幅小的,参数组相关性高的参数估计结果
- Transformer/TCN表现出锯齿状抖动,且预测参数偏向于0和1,有明显的锯齿波动,hist图展示出结果是趋近于0和1数目较多,或是激活函数的问题

(2) 模型为什么做出这样的估计结果

- 可解释性分析
- 内部权重展示

(3) 这种参数预测结果为什么能够得到可靠的预测值,

- 可视化

## 一些结论

- 目前来说使用layerNorm+sigmoid缩放的方式已经能够使输出的结果避免出现0和1的饱和问题,但是局部的预测抖动问题依旧存在 (10/31)
- sigmoid缩放会导致输出的范围受到影响,比如sigmoid(a=0.5)会使参数估计范围限制在0.3-0.6之间,不过确实能够体现模型的周期性
- 使用EMA能够降低模型的短期波动特性使结果更加平滑